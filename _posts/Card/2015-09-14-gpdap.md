---
layout:     post
title:      GP数据认证模式(DAP)介绍
category: Card
description: Data Authentication Pattern
---
全域的权限中有这么两种情况，一种是DAP验证权限，一种是强制DAP验证权限,其作用就是应用提供方可以对其加载到卡片的应用代码进行完整性和真实性的验证，完整性是通过SHA1来保证的，真实性则是通过Mac来保证。

具备“DAP验证权限”的应用提供方安全域，代表应用提供方提供了这种验证服务。表示加载到此安全域的所有应用都需要进行完整性和真实性验证。

具备“强制DAP验证权限”的应用提供方安全域要求加载到卡片的所有应用代码都要进行完整性和真实性的验证，该权限可以分配给安全域。

很明显，“DAP验证权限”与“强制DAP验证权限”区别在于一个只针对加载到自身安全域的应用，一个针对所有加载到卡片的应用。


DAP如何使用呢？

安全域的所有者创建一个加载文件数据块哈希的签名。这个签名是一个加载文件数据块哈希的MAC。这个签名被提供给任何负责加载已签名应用代码至卡片的实体对象（如中国移动）。安全域的AID与DAP验证签名一并放入加载文件的DAP数据块中发给卡片。

具体可以参考LOAD指令:

一个DAP块在加载文件中是可选的，除非相关的安全域有DAP验证的权限或者一个具有强制DAP验证权限的安全域存在。一个正确的DAP块应该由安全域的AID和加载文件数据块的签名组成。

一个加载文件可以包含多个DAP块，每个DAP块被TAG‘E2’标记,并由此引出加载文件数据块，C3即为DAP块签名，完整性和真实性由此保证。
